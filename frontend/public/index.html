<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Hide To Survive — Photon Phase (Laser-Tag)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" href="/favicon.svg" />
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <header class="hts-header" role="banner">
    <a class="logo-link" href="/" aria-label="Home">
      <img id="siteLogo" src="/logo.png" alt="Survive.com logo" onerror="this.onerror=null;this.src='/logo.svg'"/>
    </a>

    <nav class="top-actions" aria-label="Top actions">
      <button id="navLogin" class="nav-btn">Login</button>
      <button id="navHow" class="nav-btn">How To Play</button>
      <button id="navPlay" class="nav-btn">Play</button>
      <button id="navContact" class="nav-btn">Contact</button>
    </nav>
  </header>

  <main class="main-content" role="main">
    <!-- LOGIN / JOIN -->
    <section id="pageLogin" class="page active" aria-labelledby="loginTitle">
      <main class="menu-card" role="region" aria-label="Join menu">
        <h1 id="loginTitle" class="menu-title">HIDE TO SURVIVE</h1>
        <p class="menu-subtitle">Photon Phase — a laser-tag twist with Phase-chase. Tag opponents, build Charge, activate Phase to bypass walls.</p>

        <div class="menu-form">
          <label for="playerName">Name</label>
          <input id="playerName" type="text" placeholder="Player#1234" maxlength="30" />

          <label for="roomId">Room (optional)</label>
          <div class="row">
            <input id="roomId" type="text" placeholder="default" />
            <button id="createRoomBtn" class="btn-secondary">Create Room</button>
          </div>

          <div id="inviteArea" class="invite-area hidden">
            <span id="inviteText" class="invite-text"></span>
          </div>

          <label for="botCount">Bot Count</label>
          <input id="botCount" type="number" min="0" max="64" value="8" />

          <div style="margin-top:12px">
            <button id="joinBtn" class="btn-primary">JOIN MATCH</button>
          </div>

          <p class="hint">Click the canvas to lock pointer. Move with WASD / arrow keys, look with mouse. E pick up, F use serum. Left-click to shoot.</p>
        </div>
      </main>
    </section>

    <!-- HOW TO PLAY - Photon Phase rules -->
    <section id="pageHow" class="page" aria-labelledby="howTitle">
      <main class="menu-card">
        <h2 id="howTitle">HOW TO PLAY — Photon Phase (Laser-Tag)</h2>
        <div class="menu-howto">
          <ol>
            <li><strong>Overview</strong>: Everyone is armed with a safe laser. Tag opponents to score points and build Charge.</li>
            <li><strong>Scoring</strong>: Each successful tag gives +10 points and +1 Charge to the shooter.</li>
            <li><strong>Charge &amp; Phase (Twist)</strong>: At 5 Charge you can activate Phase — you temporarily pass through walls for 6 seconds to pursue targets and earn bonus points. Use the Phase button when available.</li>
            <li><strong>Stun &amp; Recovery</strong>: When tagged you are stunned for 2 seconds (can't shoot). There is a 5-second spawn protection after joining so you won't be immediately tagged.</li>
            <li><strong>Hiding Spots</strong>: Buildings, bushes and vehicles provide cover. Toggle "Show Hides" to highlight probable hiding spots.</li>
            <li><strong>Pickups</strong>: Shields absorb a tag. Serums remove stun and restore play.</li>
            <li><strong>Game Modes</strong>: Timed match or first-to-X points. Admins can customize via server options.</li>
            <li><strong>Novelty</strong>: Phase-chase — Phase enables wall traversal for aggressive pursuit, rewarding timing and map knowledge.</li>
          </ol>
        </div>
      </main>
    </section>

    <!-- CONTACT / SUPPORT -->
    <section id="pageContact" class="page" aria-labelledby="contactTitle">
      <main class="menu-card contact-card">
        <button class="contact-close" id="contactClose" aria-label="Close contact form">✕</button>
        <h2 id="contactTitle">Contact Support</h2>

        <div id="contactSuccess" class="support-success hidden" role="status">
          <span id="contactSuccessText">Message sent — thank you. Our support team will reply shortly.</span>
          <button id="contactSuccessClose" class="support-success-close" aria-label="Close">✕</button>
        </div>

        <div class="menu-form" id="contactFormWrap">
          <label for="contactName">Your name</label>
          <input id="contactName" type="text" placeholder="Jane Doe" maxlength="80" />

          <label for="contactEmail">Email</label>
          <input id="contactEmail" type="email" placeholder="you@example.com" maxlength="120" />

          <label for="contactSubject">Subject</label>
          <input id="contactSubject" type="text" placeholder="Brief subject" maxlength="140" />

          <label for="contactMessage">Message</label>
          <textarea id="contactMessage" rows="6" placeholder="Describe your issue or question" maxlength="4000"></textarea>

          <div style="margin-top:12px;display:flex;gap:8px;align-items:center;">
            <button id="contactSendBtn" class="btn-primary">Send Message</button>
            <span id="contactStatus" class="muted small"></span>
          </div>
        </div>
      </main>
    </section>

    <!-- PLAY AREA -->
    <section id="pagePlay" class="page" aria-label="Play area">
      <div id="playOverlay" class="click-to-play">Click here to play (locks pointer)</div>
      <canvas id="gameCanvas" aria-hidden="true"></canvas>

      <div id="hud" class="hud hidden" role="complementary">
        <div id="playerDisplayName" class="hud-role">Player</div>
        <div id="roleLabel" class="hud-role">PLAYER</div>
        <div id="playersLabel" class="hud-item">0 players</div>
        <div id="scoreLabel" class="hud-item">Points: 0  Charge: 0</div>
        <div id="connectionStatus" class="hud-item connection"></div>
        <div id="shieldStatus" class="hud-item shield"></div>
        <!-- Phase button and "Show Hides" will be added dynamically by game.js -->
        <div style="margin-top:8px">
          <button id="leaveBtn" class="btn-secondary">Leave Match</button>
        </div>
      </div>

      <aside id="leaderboard" class="leaderboard hidden" aria-label="Leaderboard">
        <h3>Leaderboard</h3>
        <ul id="leaderboardList"></ul>
      </aside>

      <div id="tranqOverlay" class="tranq-overlay hidden">
        <div class="tranq-overlay-inner"><h2>STUNNED</h2><p>You're stunned for a moment. Use a serum (F) if you have one.</p></div>
      </div>

      <div id="hintsPanel" class="hints-panel hidden">
        <h4>Quick Hints</h4>
        <ul>
          <li>Click overlay to lock pointer, then move with WASD / arrow keys.</li>
          <li>Left-click to fire lasers. Tags give points and charge.</li>
          <li>Reach Charge 5 to Activate Phase (temporary wall pass-through).</li>
        </ul>
      </div>

      <button id="shootBtn" class="shoot-btn">SHOOT</button>
    </section>
  </main>

  <footer class="site-footer" role="contentinfo">
    <div class="footer-inner">
      <div class="footer-left">
        <span class="copyright-symbol">©</span>
        <span class="copyright-year">2025</span>
        <a class="brand" href="https://survive.com" target="_blank" rel="noopener">Survive.com</a>
      </div>

      <div class="footer-right">
        <a id="supportLink" class="support-link" href="#" title="Contact support">Support</a>
      </div>
    </div>
  </footer>

  <!-- scripts -->
  <script src="/env.js"></script>
  <script src="https://unpkg.com/three@0.152.2/build/three.min.js"></script>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <script src="/initThree.js"></script>
  <script src="/initVoxel.js"></script>
  <script src="/game.js"></script>

  <script>
    (function () {
      function $(id){ return document.getElementById(id); }
      function showPage(id) {
        document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
        const el = document.getElementById(id); if (el) el.classList.add('active');
      }

      document.getElementById('navHow').addEventListener('click', (e)=>{ e.preventDefault(); showPage('pageHow'); });
      document.getElementById('navLogin').addEventListener('click', (e)=>{ e.preventDefault(); showPage('pageLogin'); });
      document.getElementById('navPlay').addEventListener('click', (e)=>{ e.preventDefault(); if (window.myId || (window.hts && window.hts.socketConnected)) showPage('pagePlay'); else { alert('Please JOIN MATCH first'); showPage('pageLogin'); } });
      document.getElementById('navContact').addEventListener('click', (e)=>{ e.preventDefault(); showPage('pageContact'); });

      document.getElementById('supportLink').addEventListener('click', function(e){
        e.preventDefault();
        showPage('pageContact');
      });

      // contact handlers
      const contactSendBtn = document.getElementById('contactSendBtn');
      const contactSuccess = document.getElementById('contactSuccess');
      const contactFormWrap = document.getElementById('contactFormWrap');
      const contactStatus = document.getElementById('contactStatus');
      const contactClose = document.getElementById('contactClose');
      const contactSuccessClose = document.getElementById('contactSuccessClose');

      if (contactClose) contactClose.addEventListener('click', (e)=>{ e.preventDefault(); showPage('pageLogin'); });
      if (contactSuccessClose) contactSuccessClose.addEventListener('click', (e)=>{ e.preventDefault(); contactSuccess.classList.add('hidden'); showPage('pageLogin'); });

      if (contactSendBtn) {
        contactSendBtn.addEventListener('click', async function(e){
          e.preventDefault();
          contactStatus.textContent = '';
          const name = (document.getElementById('contactName').value || '').trim();
          const email = (document.getElementById('contactEmail').value || '').trim();
          const subject = (document.getElementById('contactSubject').value || '').trim();
          const message = (document.getElementById('contactMessage').value || '').trim();
          if (!email || !message) { alert('Please provide your email and a message'); return; }
          contactSendBtn.disabled = true; contactStatus.textContent = 'Sending…';
          try {
            const resp = await fetch('/support', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ name, email, subject, message })
            });
            const j = await resp.json();
            if (j && j.ok) {
              contactFormWrap.classList.add('hidden');
              contactSuccess.classList.remove('hidden');
              contactStatus.textContent = '';
            } else {
              contactStatus.textContent = 'Could not send message. Try again later.';
              console.warn('support error', j);
            }
          } catch (err) {
            console.error('support send failed', err);
            contactStatus.textContent = 'Send failed. Try again later.';
          } finally {
            contactSendBtn.disabled = false;
            setTimeout(()=>{ if (contactStatus) contactStatus.textContent = ''; }, 4000);
          }
        });
      }
    })();
  </script>
</body>
</html>
